#!/bin/bash

set -euo pipefail
pidfile="${HOME}/.cache/__jangho-pomodoro-session.pid"
topic="${HOME}/.cache/__jangho-pomodoro-session.topic"

if [[ -z "${1+x}" ]]; then
  if [[ -f "${pidfile}" ]] && kill -0 "$(cat "${pidfile}")"; then
    jdunstify pomodoro-is-running "Pomodoro: $(cat "${topic}")"
    exit 0
  else
    jdunstify pomodoro 'Please specify topic'
    exit 1
  fi
fi

[[ -f "${pidfile}" ]] && kill "$(cat "${pidfile}")" && \
  jdunstify pomodoro 'Stopping pomodoro' && rm -f "${pidfile}" && rm -f "${topic}" || :

if [[ "$*" == 'stop' ]]; then
  exit 0
fi

echo "$*" | exec "${HOME}/.setup/jangho-desktop/lib/bin/__jangho-pomodoro-session"
