#!/bin/bash

set -euo pipefail
pidfile="${HOME}/.cache/__jangho-pomodoro-session.pid"

if [[ -z "${1+x}" ]]; then
  jdunstify pomodoro 'Please specify topic'
  exit 1
fi

[[ -f "${pidfile}" ]] && kill "$(cat "${pidfile}")" && \
  jdunstify pomodoro 'Stopping pomodoro' && rm -f "${pidfile}" || :

if [[ "$*" == 'stop' ]]; then
  exit 0
fi

echo "$*" | exec "${HOME}/.setup/jangho-desktop/lib/bin/__jangho-pomodoro-session"
