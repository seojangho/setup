#!/bin/bash

set -euo pipefail

BINDIR=${HOME}/.setup/jangho-desktop/lib/bin

declare -a hints
while :; do
  mode=$(swaymsg -t subscribe '["mode"]' 2>/dev/null | "${BINDIR}/parse_mode_change" 2>/dev/null) || exit 0
  hints=()
  timeout=2000
  if [[ "${mode}" != 'default' ]]; then
    timeout=0
    hints=(-h string:bgcolor:#ffff00 -h string:fgcolor:#000000)
  fi

  jdunstify swaymode "${mode}" "--timeout=${timeout}" "${hints[@]}" || continue
done
