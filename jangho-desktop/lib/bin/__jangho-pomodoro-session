#!/bin/bash

set -euo pipefail

topic=$(cat)

echo "$$" > "${HOME}/.cache/__jangho-pomodoro-session.pid"

while :; do
  start_time=$(date --iso-8601=seconds)
  jdunstify pomodoro "Stay focused on ${topic}!"
  sleep 10s
  end_time=$(date --iso-8601=seconds)
  echo "${topic}" | ssh jangho@mango.jangho.io -p50022 -- /opt/mango/sendmail/pomodoro_success_log "${start_time}" "${end_time}"
  jdunstify pomodoro "Well done! Take a rest :)"
  sleep 10s
done
