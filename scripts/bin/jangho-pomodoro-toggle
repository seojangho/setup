#!/bin/bash

current_tracking="$(timew)"
current_tracking_exit=$?

if [[ $current_tracking_exit -eq 0 ]]
then
  zenity --question --text="$current_tracking""\nCancel current tracking?" --title="Pomodoro" --icon-name=gnome-pomodoro
  cancel_tracking_exit=$?
  if [[ cancel_tracking_exit -ne 0 ]]
  then
    exit 1
  fi
fi

timew stop
if killall jangho-pomodoro
then
  notify-send --icon=gnome-pomodoro "Stopped Pomodoro" "Come back when you're ready"
  exit 0
fi

POMODORO_TASK="$(zenity --entry --title="Starting Pomodoro" --text="$(timew summary :day)")"
INPUT_SUCCESS=$?
if [[ $INPUT_SUCCESS -eq 0 ]]
then
  if [[ "$POMODORO_TASK" == "" ]]
  then
    timew continue
  else
    timew start "$POMODORO_TASK"
  fi
  exec "$HOME"/.setup/scripts/bin/jangho-pomodoro
else
  exit 1
fi
