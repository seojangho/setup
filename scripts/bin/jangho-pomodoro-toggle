#!/bin/bash

current_tracking="$(timew)"
current_tracking_exit=$?

if [[ $current_tracking_exit -eq 0 ]]
then
  zenity --question --text="$current_tracking""\nCancel current tracking?" --title="Pomodoro" --icon-name=gnome-pomodoro
  cancel_tracking_exit=$?
  [[ cancel_tracking_exit -ne 0 ]] && exit 1
  timew stop
  killall jangho-pomodoro
  exit 0
fi

pomodoro_task="$(zenity --entry --title="Starting Pomodoro" --text="$(timew summary :day)")"
input_success=$?
if [[ $input_success -eq 0 ]]
then
  if [[ "$pomodoro_task" == "" ]]
  then
    timew continue
  else
    timew start "$pomodoro_task"
  fi
  exec "$HOME"/.setup/scripts/bin/jangho-pomodoro
else
  exit 1
fi
